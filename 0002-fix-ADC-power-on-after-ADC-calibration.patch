From f809e385c864c862bc429bb655bffbebbf941180 Mon Sep 17 00:00:00 2001
From: Oleg Artamonov <oleg@unwds.com>
Date: Sun, 16 Jun 2019 13:59:19 +0300
Subject: [PATCH] lib/stm32: fix ADC power on after ADC calibration on F0
 devices

---
 lib/stm32/common/adc_common_v2.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git libopencm3/lib/stm32/common/adc_common_v2.c b/lib/stm32/common/adc_common_v2.c
index fb22d273..f38765bf 100644
--- libopencm3/lib/stm32/common/adc_common_v2.c
+++ libopencm3/lib/stm32/common/adc_common_v2.c
@@ -93,7 +93,10 @@ bool adc_is_power_on(uint32_t adc)
  */
 void adc_power_on(uint32_t adc)
 {
-	adc_power_on_async(adc);
+    /* Workaround for STM32F0x2 Device Errata (see ES0243 2.4.2) */
+	do {
+        adc_power_on_async(adc);
+    }
 	while (!adc_is_power_on(adc));
 }
 
-- 
2.17.1

